<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºèƒ½åˆ·é¢˜å¹³å°</title>
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-light: #eff6ff;
      --secondary-color: #3b82f6;
      --accent-color: #60a5fa;
      --text-main: #1e293b;
      --text-light: #64748b;
      --bg-color: #f1f5f9;
      --card-bg: #ffffff;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-main);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* é¡¶éƒ¨å¯¼èˆª */
    header {
      background: var(--card-bg);
      box-shadow: var(--shadow);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo span {
      color: var(--text-main);
      font-weight: 400;
      font-size: 1rem;
    }

    .nav-tabs {
      display: flex;
      gap: 1rem;
      background: var(--bg-color);
      padding: 5px;
      border-radius: var(--radius);
    }

    .nav-btn {
      border: none;
      background: transparent;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      color: var(--text-light);
      font-weight: 600;
      transition: var(--transition);
    }

    .nav-btn:hover {
      color: var(--primary-color);
      background: rgba(37, 99, 235, 0.1);
    }

    .nav-btn.active {
      background: var(--card-bg);
      color: var(--primary-color);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .user-actions {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: var(--transition);
    }

    .action-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    /* ä¸»å†…å®¹åŒº */
    main {
      flex: 1;
      max-width: 1000px;
      margin: 2rem auto;
      width: 100%;
      padding: 0 1rem;
    }

    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .stat-label {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    /* é¢˜ç›®å¡ç‰‡ */
    .question-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      position: relative;
      overflow: hidden;
      min-height: 400px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      align-items: flex-start;
    }

    .tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .tag {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .tag-type {
      background: var(--primary-light);
      color: var(--primary-color);
    }

    .tag-cat {
      background: #f3f4f6;
      color: #4b5563;
    }

    .q-text {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 2rem;
      color: var(--text-main);
    }

    .options-grid {
      display: grid;
      gap: 1rem;
    }

    .option-btn {
      text-align: left;
      padding: 1rem 1.5rem;
      background: #f8fafc;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
    }

    .option-btn:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
    }

    .option-btn.selected {
      border-color: var(--primary-color);
      background: var(--primary-light);
    }

    .option-btn.correct {
      border-color: var(--success);
      background: #ecfdf5;
    }

    .option-btn.wrong {
      border-color: var(--error);
      background: #fef2f2;
    }

    /* è§£æåŒºåŸŸ */
    .explanation-box {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #fffbeb;
      border-left: 4px solid var(--warning);
      border-radius: 0 8px 8px 0;
      display: none;
      animation: slideDown 0.3s ease;
    }

    .explanation-box.visible {
      display: block;
    }

    .exp-title {
      font-weight: 700;
      color: #b45309;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* åº•éƒ¨æ§åˆ¶æ  */
    .control-bar {
      margin-top: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 1rem;
      border-top: 1px solid #e2e8f0;
      flex-wrap: wrap;
      gap: 10px;
    }

    .primary-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
      transition: var(--transition);
    }

    .primary-btn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }

    .icon-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      color: #cbd5e1;
      transition: var(--transition);
    }

    .icon-btn.active {
      color: var(--warning);
      transform: scale(1.1);
    }

    /* è€ƒè¯•æ¨¡å¼ç‰¹æœ‰ */
    .exam-header {
      display: flex;
      justify-content: space-between;
      background: var(--text-main);
      color: white;
      padding: 1rem;
      border-radius: var(--radius);
      margin-bottom: 1rem;
      align-items: center;
    }

    .timer {
      font-family: monospace;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--warning);
    }

    .exam-palette {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(35px, 1fr));
      gap: 5px;
      margin-bottom: 2rem;
    }

    .palette-item {
      width: 35px;
      height: 35px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 50%;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .palette-item.answered {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .palette-item.current {
      outline: 2px solid var(--warning);
      outline-offset: 2px;
    }

    .palette-item.review {
      background: var(--warning);
      color: white;
    }

    /* å¼¹çª— */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: var(--radius);
      width: 90%;
      max-width: 500px;
      text-align: center;
      animation: zoomIn 0.3s;
    }

    .score-circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      border: 8px solid var(--primary-color);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--primary-color);
      margin: 0 auto 1.5rem;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes zoomIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .nav-container { flex-direction: column; gap: 1rem; }
      .nav-tabs { width: 100%; overflow-x: auto; }
      .question-card { padding: 1rem; }
      .control-bar { flex-direction: column-reverse; align-items: stretch; }
      .control-bar > div { justify-content: space-between; width: 100%; }
    }

    .hidden { display: none !important; }
  </style>
</head>

<body>

  <header>
    <div class="nav-container">
      <div class="logo">æ™ºèƒ½åˆ·é¢˜<span>å¢å¼ºç‰ˆ</span></div>
      <nav class="nav-tabs">
        <button class="nav-btn active" onclick="switchMode('home')">é¦–é¡µæ¦‚è§ˆ</button>
        <button class="nav-btn" onclick="switchMode('random')">éšæœºåˆ·é¢˜</button>
        <button class="nav-btn" onclick="switchMode('sequential')">é¡ºåºåˆ·é¢˜</button>
        <button class="nav-btn" onclick="startExamConfig()">æ¨¡æ‹Ÿè€ƒè¯•</button>
        <button class="nav-btn" onclick="switchMode('mistakes')">é”™é¢˜æœ¬</button>
      </nav>
      <div class="user-actions">
        <button class="action-btn" onclick="restoreDefaultBank()" title="æ¸…é™¤å¯¼å…¥çš„é¢˜åº“ï¼Œæ¢å¤ç³»ç»Ÿé»˜è®¤" style="color: var(--warning);">â†º æ¢å¤é»˜è®¤</button>
        <button class="action-btn" onclick="exportData()" title="å¯¼å‡ºå­¦ä¹ è¿›åº¦">â¬‡ å¯¼å‡º</button>
        <button class="action-btn" onclick="importData()" title="å¯¼å…¥å­¦ä¹ è¿›åº¦/é¢˜åº“">â¬† å¯¼å…¥</button>
        <input type="file" id="importFile" style="display: none;" onchange="handleImport(this)">
      </div>
    </div>
  </header>

  <main id="main-container">
    <div id="home-view">
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-value" id="total-questions-count">0</div>
          <div class="stat-label">å½“å‰é¢˜åº“æ€»æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="user-done-count">0</div>
          <div class="stat-label">å·²åˆ·é¢˜ç›®</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="user-correct-rate">0%</div>
          <div class="stat-label">æ­£ç¡®ç‡</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="user-mistake-count">0</div>
          <div class="stat-label">é”™é¢˜å¾…å¤ä¹ </div>
        </div>
      </div>
 
      <div style="text-align: center; margin-top: 3rem; color: var(--text-light);">
        <h3>æ¬¢è¿ä½¿ç”¨æ™ºèƒ½åˆ·é¢˜å¹³å°</h3>
        <p style="margin-top: 10px;">æ”¯æŒè‡ªå®šä¹‰é¢˜åº“å¯¼å…¥ã€è¿›åº¦è‡ªåŠ¨ä¿å­˜ã€é¡ºåº/éšæœºåˆ·é¢˜</p>
        <p style="font-size: 0.9rem; margin-top: 5px; opacity: 0.7;">(æç¤ºï¼šå¯¼å…¥çš„é¢˜åº“ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æµè§ˆå™¨ï¼Œä¸‹æ¬¡è®¿é—®æ— éœ€é‡æ–°å¯¼å…¥)</p>
      </div>
    </div>

    <div id="practice-view" class="hidden">
      <div class="question-card" id="practice-card">
        <div class="card-header">
          <div class="tags">
            <span class="tag tag-type" id="q-type">å•é€‰é¢˜</span>
            <span class="tag tag-cat" id="q-cat">çŸ¥è¯†ç‚¹</span>
            <span class="tag" id="q-index-badge" style="background:#e2e8f0">#1</span>
          </div>
          <button class="icon-btn" id="fav-btn" onclick="toggleFavorite()">â˜…</button>
        </div>
        <div class="q-text" id="q-content">é¢˜ç›®åŠ è½½ä¸­...</div>
        <div class="options-grid" id="options-area">
          </div>
        <div class="explanation-box" id="explanation-area">
          <div class="exp-title">ğŸ’¡ ç­”æ¡ˆè§£æ</div>
          <div id="exp-text"></div>
        </div>

        <div class="control-bar">
          <div style="display: flex; gap: 10px; align-items: center;">
            <button class="action-btn" onclick="clearProgress()" style="color: #ef4444; border-color: #ef4444;">é‡ç½®è¿›åº¦</button>
            <div id="jump-container" style="display: none; align-items: center; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; background: white;">
                <input type="number" id="jump-input" placeholder="é¢˜å·" style="width: 60px; border: none; padding: 8px; text-align: center; outline: none;">
                <button onclick="jumpToQuestion()" style="border: none; background: #f1f5f9; padding: 8px 12px; cursor: pointer; border-left: 1px solid #e2e8f0;">Go</button>
            </div>
          </div>
          
          <div style="display: flex; gap: 10px;">
              <button class="action-btn" onclick="prevQuestion()">â¬… ä¸Šä¸€é¢˜</button>
              <button class="primary-btn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ âœ</button>
          </div>
        </div>
      </div>
    </div>

    <div id="exam-view" class="hidden">
      <div class="exam-header">
        <div>
          <span style="font-size: 1.2rem;">æ¨¡æ‹Ÿè€ƒè¯•</span>
          <span style="font-size: 0.8rem; opacity: 0.8; margin-left: 10px;">æ€»åˆ†: 1000 | åŠæ ¼: 600</span>
        </div>
        <div class="timer" id="exam-timer">60:00</div>
      </div>
      <div class="exam-palette" id="exam-palette">
        </div>
      <div class="question-card">
        <div class="card-header">
          <div class="tags">
            <span class="tag tag-type" id="exam-q-type">ç±»å‹</span>
            <span class="tag tag-cat" id="exam-q-cat">ç§‘ç›®</span>
          </div>
          <button class="action-btn" onclick="markForReview()">æ ‡è®°</button>
        </div>
        <div class="q-text" id="exam-q-content"></div>
        <div class="options-grid" id="exam-options-area"></div>
        <div class="control-bar">
          <button class="action-btn" onclick="prevExamQ()">ä¸Šä¸€é¢˜</button>
          <button class="primary-btn" onclick="submitExam()" style="background: var(--success);">äº¤å·</button>
          <button class="primary-btn" onclick="nextExamQ()">ä¸‹ä¸€é¢˜</button>
        </div>
      </div>
    </div>
  </main>

  <div class="modal" id="result-modal">
    <div class="modal-content">
      <h2>è€ƒè¯•ç»“æŸ</h2>
      <div class="score-circle" id="final-score">0</div>
      <p id="pass-status" style="font-size: 1.2rem; margin-bottom: 1rem;">æœªé€šè¿‡</p>
      <div style="text-align: left; background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; max-height: 150px; overflow-y: auto;">
        <p><strong>é”™é¢˜åˆ†å¸ƒï¼š</strong></p>
        <ul id="wrong-list" style="padding-left: 20px; color: var(--error);"></ul>
      </div>
      <button class="primary-btn" onclick="closeModal()">å…³é—­å¹¶æŸ¥çœ‹è§£æ</button>
    </div>
  </div>

  <script>
    /**
     * ç³»ç»Ÿé»˜è®¤é¢˜åº“ (Raw Data)
     * å½“æœ¬åœ°æ²¡æœ‰ç¼“å­˜çš„è‡ªå®šä¹‰é¢˜åº“æ—¶ï¼Œå°†åŠ è½½æ­¤æ•°æ®
     */
    const rawQuestions = [
      { "id": 397394, "type": "å•é€‰é¢˜", "q": "åœ¨ä¿¡ç”¨å¡æ¬ºè¯ˆæ£€æµ‹åœºæ™¯å’Œåƒåœ¾é‚®ä»¶åˆ†ç±»åœºæ™¯ä¸­ï¼Œåˆ†åˆ«å¯¹æ¨¡å‹çš„å“ªä¸ªè¯„ä¼°æŒ‡æ ‡è¦æ±‚è¾ƒé«˜ï¼Ÿ", "options": [ "å¬å›ç‡ã€ç²¾åº¦", "å¬å›ç‡ã€å¬å›ç‡", "ç²¾åº¦ã€ç²¾åº¦", "ç²¾åº¦ã€å¬å›ç‡" ], "ans": "A", "exp": "åœ¨ä¿¡ç”¨å¡æ¬ºè¯ˆæ£€æµ‹ä¸­ï¼Œå®å¯é”™æ€ä¸€åƒï¼ˆè¯¯æŠ¥ï¼‰ï¼Œä¸å¯æ”¾è¿‡ä¸€ä¸ªï¼ˆæ¼æŠ¥ï¼‰ï¼Œå› æ­¤çœ‹é‡å¬å›ç‡ï¼›åƒåœ¾é‚®ä»¶åˆ†ç±»ä¸­ï¼Œå¦‚æœæŠŠé‡è¦é‚®ä»¶å½“æˆåƒåœ¾é‚®ä»¶ï¼ˆè¯¯æŠ¥ï¼‰ä¼šé€ æˆä¸¥é‡åæœï¼Œå› æ­¤çœ‹é‡ç²¾åº¦ã€‚" },
      { "id": 397393, "type": "å•é€‰é¢˜", "q": "ä»¥ä¸‹å…³äºæœºå™¨å­¦ä¹ æ•´ä½“æµç¨‹æè¿°æ­£ç¡®çš„æ˜¯å“ªä¸€é¡¹ï¼Ÿ", "options": [ "æ•°æ®æ”¶é›† â†’æ•°æ®æ¸…æ´—â†’ç‰¹å¾æå–ä¸é€‰æ‹©â†’æ¨¡å‹è®­ç»ƒâ†’æ¨¡å‹éƒ¨ç½²ä¸æ•´åˆâ†’æ¨¡å‹è¯„ä¼°æµ‹è¯•", "æ•°æ®æ”¶é›†â†’ç‰¹å¾æå–ä¸é€‰æ‹©â†’æ•°æ®æ¸…æ´—â†’æ¨¡å‹è®­ç»ƒâ†’æ¨¡å‹è¯„ä¼°æµ‹è¯•â†’æ¨¡å‹éƒ¨ç½²ä¸æ•´åˆ", "æ•°æ®æ”¶é›†â†’æ•°æ®æ¸…æ´—â†’æ¨¡å‹è®­ç»ƒâ†’ç‰¹å¾æå–ä¸é€‰æ‹©â†’æ¨¡å‹è¯„ä¼°æµ‹è¯•â†’æ¨¡å‹éƒ¨ç½²ä¸æ•´åˆ", "æ•°æ®æ”¶é›†â†’æ•°æ®æ¸…æ´—â†’ç‰¹å¾æå–ä¸é€‰æ‹©â†’æ¨¡å‹è®­ç»ƒâ†’æ¨¡å‹è¯„ä¼°æµ‹è¯•â†’æ¨¡å‹éƒ¨ç½²ä¸æ•´åˆ" ], "ans": "D", "exp": "æ ‡å‡†æµç¨‹ï¼šæ”¶é›† -> æ¸…æ´—ï¼ˆé¢„å¤„ç†ï¼‰ -> ç‰¹å¾å·¥ç¨‹ï¼ˆæå–/é€‰æ‹©ï¼‰ -> è®­ç»ƒ -> è¯„ä¼° -> éƒ¨ç½²ã€‚" },
      { "id": 397392, "type": "å•é€‰é¢˜", "q": "ä»¥ä¸‹å…³äº CPU ä½æ—¶å»¶è®¾è®¡çš„æè¿°ï¼Œé”™è¯¯çš„æ˜¯å“ªä¸€ä¸ªé€‰é¡¹ï¼Ÿ", "options": [ "æœ‰å¾ˆå¤š ALU å’Œå¾ˆå°‘ Cacheï¼Œç¼“å­˜åˆå¹¶è®¿é—® DRAMï¼Œé™ä½æ—¶å»¶", "é«˜æ—¶é’Ÿé¢‘ç‡é™ä½æ—¶å»¶", "å¼ºå¤§çš„ ALU å•å…ƒï¼Œå¯åœ¨å¾ˆçŸ­æ—¶é’Ÿå‘¨æœŸå®Œæˆè®¡ç®—", "å¤æ‚é€»è¾‘æ§åˆ¶å•å…ƒï¼Œå¤šåˆ†æ”¯ç¨‹åºå¯é€šè¿‡åˆ†æ”¯é¢„æµ‹èƒ½åŠ›é™ä½æ—¶å»¶" ], "ans": "A", "exp": "CPUä¸ºäº†ä½æ—¶å»¶ï¼Œé€šå¸¸é…å¤‡å¤§é‡çš„Cacheï¼ˆL1/L2/L3ï¼‰æ¥å‡å°‘è®¿é—®ä¸»å­˜ï¼ˆDRAMï¼‰çš„æ¬¡æ•°ï¼Œè€Œä¸æ˜¯â€œå¾ˆå°‘Cacheâ€ã€‚GPUæ‰æ˜¯ALUå¤šã€Cacheå°‘ã€‚" },
      // ... ä¸ºäº†æ–‡ä»¶ä½“ç§¯ä¸è¿‡å¤§ï¼Œè¿™é‡Œçœç•¥äº†ä¸­é—´çš„æ•°ç™¾é“é¢˜ï¼Œå®é™…ä½¿ç”¨æ—¶è¯·å°†åŸæ–‡ä»¶ä¸­çš„æ‰€æœ‰é¢˜ç›®ä¿ç•™åœ¨è¿™é‡Œ ...
      // æ‚¨å¯ä»¥ç›´æ¥æŠŠ index.txt é‡Œçš„ rawQuestions æ•°ç»„å†…å®¹å®Œæ•´å¤åˆ¶è¿‡æ¥æ›¿æ¢è¿™é‡Œ
      { "id": 397318, "type": "åˆ¤æ–­é¢˜", "q": "AI å¼€å‘æ¡†æ¶å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºè‡ªå·±çš„æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥å®ç°è·¨å¹³å°å’Œè·¨ç¡¬ä»¶çš„åˆ†å¸ƒå¼è®­ç»ƒã€‚", "options": [ "æ­£ç¡®", "é”™è¯¯" ], "ans": "A", "exp": "æ­£ç¡®ã€‚" }
    ];

    // å…¨å±€å˜é‡
    let questionBank = [];
    
    // çŸ¥è¯†ç‚¹åˆ†ç±»å…³é”®è¯
    const categoryKeywords = {
      "äººå·¥æ™ºèƒ½æ¦‚è§ˆ": ["äººå·¥æ™ºèƒ½", "AI", "å›¾çµ", "å¼ºäººå·¥æ™ºèƒ½", "å¼±äººå·¥æ™ºèƒ½", "Agent", "æ™ºèƒ½ä½“"],
      "æœºå™¨å­¦ä¹ æ¦‚è§ˆ": ["æœºå™¨å­¦ä¹ ", "èšç±»", "å›å½’", "åˆ†ç±»", "éšæœºæ£®æ—", "é›†æˆå­¦ä¹ ", "SVM", "K-means", "DBSCAN", "å†³ç­–æ ‘", "å¬å›ç‡", "ç²¾åº¦", "F1", "è¿‡æ‹Ÿåˆ", "æ¬ æ‹Ÿåˆ"],
      "æ·±åº¦å­¦ä¹ å’Œå¤§æ¨¡å‹": ["æ·±åº¦å­¦ä¹ ", "ç¥ç»ç½‘ç»œ", "å·ç§¯", "CNN", "RNN", "LSTM", "Transformer", "LLM", "DeepSeek", "MoE", "æ¿€æ´»å‡½æ•°", "ReLU", "æ¢¯åº¦", "åå‘ä¼ æ’­", "æŸå¤±å‡½æ•°", "Seq2Seq", "çŸ¥è¯†è’¸é¦"],
      "äººå·¥æ™ºèƒ½å¼€å‘æ¡†æ¶": ["æ¡†æ¶", "PyTorch", "MindSpore", "TensorFlow", "è®¡ç®—å›¾", "åŠ¨æ€å›¾", "é™æ€å›¾", "ckpt", "MindRecord", "å¼ é‡"],
      "åä¸ºäººå·¥æ™ºèƒ½å¹³å°": ["åä¸º", "æ˜‡è…¾", "Ascend", "CANN", "MindStudio", "AI Core", "DVPP", "AIPP", "Atlas", "ATC", "AscendCL"],
      "åº”ç”¨åœºæ™¯": ["CV", "NLP", "è¯­éŸ³", "å›¾åƒ", "è‡ªåŠ¨é©¾é©¶", "åŒ»ç–—", "æ™ºæ…§", "æœºå™¨äºº", "ç¿»è¯‘"]
    };

    // åº”ç”¨çŠ¶æ€
    let appState = {
      mode: 'home',
      currentQIndex: 0,
      examQuestions: [],
      examAnswers: {}, 
      examTimer: null,
      // è¿™é‡Œçš„åˆå§‹åŒ–å¾ˆé‡è¦ï¼Œè¯»å– localStorage
      userProgress: JSON.parse(localStorage.getItem('ai_ia_progress')) || {
        done: [], 
        mistakes: [], 
        favorites: [], 
        correctCount: 0,
        totalAttempted: 0,
        lastSequenceIndex: 0 // æ–°å¢ï¼šè®°å½•é¡ºåºåˆ·é¢˜çš„ç´¢å¼•
      }
    };

    // åˆå§‹åŒ–
    function init() {
      // 1. å°è¯•åŠ è½½è‡ªå®šä¹‰é¢˜åº“
      const customBankStr = localStorage.getItem('ai_ia_custom_bank');
      if (customBankStr) {
        try {
          console.log("æ£€æµ‹åˆ°æœ¬åœ°ç¼“å­˜çš„è‡ªå®šä¹‰é¢˜åº“ï¼Œæ­£åœ¨åŠ è½½...");
          questionBank = JSON.parse(customBankStr);
        } catch (e) {
          console.error("è‡ªå®šä¹‰é¢˜åº“è§£æå¤±è´¥ï¼Œå›é€€åˆ°é»˜è®¤", e);
          questionBank = rawQuestions;
        }
      } else {
        console.log("ä½¿ç”¨ç³»ç»Ÿé»˜è®¤é¢˜åº“");
        questionBank = rawQuestions;
      }

      // å¦‚æœé¢˜åº“ä¸ºç©ºï¼ˆé˜²æ­¢æ„å¤–ï¼‰ï¼Œä½¿ç”¨raw
      if (!questionBank || questionBank.length === 0) questionBank = rawQuestions;

      autoTagQuestions();
      updateStats();
    }

    // è‡ªåŠ¨æ ‡ç­¾
    function autoTagQuestions() {
      questionBank.forEach(q => {
        if (!q.category || q.category === "å…¶ä»–") {
            q.category = "å…¶ä»–";
            for (const [cat, keywords] of Object.entries(categoryKeywords)) {
              if (keywords.some(k => q.q.includes(k) || (q.exp && q.exp.includes(k)))) {
                q.category = cat;
                break;
              }
            }
            if (q.q.includes("MindSpore")) q.category = "äººå·¥æ™ºèƒ½å¼€å‘æ¡†æ¶";
            if (q.q.includes("æ˜‡è…¾") || q.q.includes("Ascend")) q.category = "åä¸ºäººå·¥æ™ºèƒ½å¹³å°";
        }
      });
    }

    // åˆ‡æ¢æ¨¡å¼
    function switchMode(mode) {
      appState.mode = mode;
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');

      document.getElementById('home-view').classList.add('hidden');
      document.getElementById('practice-view').classList.add('hidden');
      document.getElementById('exam-view').classList.add('hidden');
      
      // éšè—è·³è½¬æ¡†é»˜è®¤
      document.getElementById('jump-container').style.display = 'none';

      if (mode === 'home') {
        document.getElementById('home-view').classList.remove('hidden');
        updateStats();
      } else if (mode === 'exam') {
        // ç”± startExamConfig å¤„ç†
      } else {
        document.getElementById('practice-view').classList.remove('hidden');
        resetCardUI();
        
        if (mode === 'random') {
          appState.currentQIndex = Math.floor(Math.random() * questionBank.length);
        } else if (mode === 'sequential') {
          // --- æ ¸å¿ƒä¿®æ”¹ï¼šè¯»å–ä¸Šæ¬¡ä¿å­˜çš„è¿›åº¦ ---
          let savedIdx = appState.userProgress.lastSequenceIndex || 0;
          // é˜²æ­¢è¶Šç•Œ
          if (savedIdx >= questionBank.length) savedIdx = 0;
          appState.currentQIndex = savedIdx;
          
          // æ˜¾ç¤ºè·³è½¬æ¡†
          document.getElementById('jump-container').style.display = 'flex';
          
        } else if (mode === 'mistakes') {
          if (appState.userProgress.mistakes.length === 0) {
            alert("é”™é¢˜æœ¬ä¸ºç©ºï¼Œå¿«å»åˆ·é¢˜å§ï¼");
            switchMode('home');
            return;
          }
          appState.currentQIndex = 0;
        }
        loadQuestion();
      }
    }

    // åŠ è½½é¢˜ç›®
    function loadQuestion() {
      let q;
      if (appState.mode === 'mistakes') {
        const id = appState.userProgress.mistakes[appState.currentQIndex];
        q = questionBank.find(item => item.id === id);
        if (!q) { 
           // é¢˜åº“å˜åŠ¨å¯¼è‡´IDæ‰¾ä¸åˆ°
           appState.currentQIndex = 0;
           return;
        }
      } else {
        q = questionBank[appState.currentQIndex];
      }

      if (!q) return;

      document.getElementById('q-type').innerText = q.type;
      document.getElementById('q-cat').innerText = q.category || "æœªåˆ†ç±»";
      
      // æ˜¾ç¤ºé¢˜å·ä¿¡æ¯
      let badgeText = `#${q.id}`;
      if (appState.mode === 'sequential') {
          badgeText += ` (ç¬¬ ${appState.currentQIndex + 1} / ${questionBank.length} é¢˜)`;
          // åŒæ­¥è¾“å…¥æ¡†
          document.getElementById('jump-input').value = appState.currentQIndex + 1;
      } else if (appState.mode === 'mistakes') {
          badgeText += ` (é”™é¢˜ ${appState.currentQIndex + 1} / ${appState.userProgress.mistakes.length})`;
      } else {
          badgeText += " (éšæœº)";
      }
      document.getElementById('q-index-badge').innerText = badgeText;
      
      document.getElementById('q-content').innerText = q.q;

      const favBtn = document.getElementById('fav-btn');
      favBtn.className = appState.userProgress.favorites.includes(q.id) ? 'icon-btn active' : 'icon-btn';

      const optsContainer = document.getElementById('options-area');
      optsContainer.innerHTML = '';
      q.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        const letter = String.fromCharCode(65 + idx); 
        btn.innerHTML = `<span style="font-weight:bold; margin-right:10px;">${letter}.</span> ${opt}`;
        btn.onclick = () => checkAnswer(q, letter, btn);
        optsContainer.appendChild(btn);
      });

      document.getElementById('explanation-area').classList.remove('visible');
      document.getElementById('exp-text').innerText = q.exp || "æš‚æ— è¯¦ç»†è§£æã€‚";
    }

    // åˆ¤åˆ†
    function checkAnswer(q, userVal, btnElement) {
      const isMulti = q.type === 'å¤šé€‰é¢˜';
      if (isMulti) {
        btnElement.classList.toggle('selected');
        if (!document.getElementById('multi-submit-btn')) {
          const submitBtn = document.createElement('button');
          submitBtn.id = 'multi-submit-btn';
          submitBtn.innerText = 'æäº¤å¤šé€‰ç­”æ¡ˆ';
          submitBtn.className = 'primary-btn';
          submitBtn.style.marginTop = '1rem';
          submitBtn.onclick = () => {
            const selected = Array.from(document.querySelectorAll('.option-btn.selected'))
              .map(b => b.innerText.charAt(0));
            finalizeAnswer(q, selected.sort());
            submitBtn.remove();
          };
          document.getElementById('options-area').after(submitBtn);
        }
      } else {
        finalizeAnswer(q, [userVal]);
      }
    }

    function finalizeAnswer(q, userArr) {
      const btns = document.querySelectorAll('.option-btn');
      let correctArr = Array.isArray(q.ans) ? q.ans : q.ans.split('');
      if (typeof q.ans === 'string' && q.ans.length > 1 && q.type === 'å¤šé€‰é¢˜') {
        correctArr = q.ans.split('');
      } else if (typeof q.ans === 'string') {
        correctArr = [q.ans];
      }

      const isCorrect = JSON.stringify(userArr.sort()) === JSON.stringify(correctArr.sort());
      
      btns.forEach(btn => {
        const letter = btn.innerText.charAt(0);
        if (correctArr.includes(letter)) btn.classList.add('correct');
        if (userArr.includes(letter) && !correctArr.includes(letter)) btn.classList.add('wrong');
        btn.disabled = true;
      });

      document.getElementById('explanation-area').classList.add('visible');

      if (!appState.userProgress.done.includes(q.id)) {
        appState.userProgress.done.push(q.id);
        appState.userProgress.totalAttempted++;
        if (isCorrect) appState.userProgress.correctCount++;
      }

      const mistakeIdx = appState.userProgress.mistakes.indexOf(q.id);
      if (!isCorrect) {
        if (mistakeIdx === -1) appState.userProgress.mistakes.push(q.id);
      }
      saveProgress();
    }

    // --- å¯¼èˆªä¸è·³è½¬ ---

    // ä¸‹ä¸€é¢˜
    function nextQuestion() {
      if (appState.mode === 'random') {
        appState.currentQIndex = Math.floor(Math.random() * questionBank.length);
      } else if (appState.mode === 'sequential') {
        appState.currentQIndex = (appState.currentQIndex + 1) % questionBank.length;
        // æ ¸å¿ƒï¼šå®æ—¶ä¿å­˜é¡ºåºè¿›åº¦
        appState.userProgress.lastSequenceIndex = appState.currentQIndex;
        saveProgress();
      } else if (appState.mode === 'mistakes') {
        if (appState.userProgress.mistakes.length === 0) {
          switchMode('home');
          return;
        }
        appState.currentQIndex = (appState.currentQIndex + 1) % appState.userProgress.mistakes.length;
      }
      resetCardUI();
      loadQuestion();
    }
    
    // ä¸Šä¸€é¢˜
    function prevQuestion() {
        if (appState.mode === 'random') {
             // éšæœºæ¨¡å¼å›é€€å¯ä»¥ç”¨å†å²è®°å½•æ ˆï¼Œè¿™é‡Œç®€åŒ–ä¸ºé‡æ–°éšæœº
             appState.currentQIndex = Math.floor(Math.random() * questionBank.length);
        } else if (appState.mode === 'sequential') {
             if (appState.currentQIndex > 0) {
                 appState.currentQIndex--;
             } else {
                 appState.currentQIndex = questionBank.length - 1; // å¾ªç¯åˆ°æœ«å°¾
             }
             // æ ¸å¿ƒï¼šä¿å­˜
             appState.userProgress.lastSequenceIndex = appState.currentQIndex;
             saveProgress();
        } else if (appState.mode === 'mistakes') {
             if (appState.currentQIndex > 0) {
                 appState.currentQIndex--;
             } else {
                 appState.currentQIndex = appState.userProgress.mistakes.length - 1;
             }
        }
        resetCardUI();
        loadQuestion();
    }
    
    // è·³è½¬
    function jumpToQuestion() {
        if (appState.mode !== 'sequential') {
            alert("è¯·åˆ‡æ¢åˆ°ã€é¡ºåºåˆ·é¢˜ã€‘æ¨¡å¼ä½¿ç”¨è·³è½¬åŠŸèƒ½");
            return;
        }
        const val = parseInt(document.getElementById('jump-input').value);
        if (isNaN(val) || val < 1 || val > questionBank.length) {
            alert(`è¯·è¾“å…¥ 1 åˆ° ${questionBank.length} ä¹‹é—´çš„æ•°å­—`);
            return;
        }
        appState.currentQIndex = val - 1;
        appState.userProgress.lastSequenceIndex = appState.currentQIndex;
        saveProgress();
        resetCardUI();
        loadQuestion();
    }

    function resetCardUI() {
      document.getElementById('explanation-area').classList.remove('visible');
      const subBtn = document.getElementById('multi-submit-btn');
      if (subBtn) subBtn.remove();
    }

    // --- è€ƒè¯•é€»è¾‘ ---

    function startExamConfig() {
      if (!confirm("å³å°†å¼€å§‹40é¢˜æ¨¡æ‹Ÿè€ƒè¯•ï¼Œé™æ—¶60åˆ†é’Ÿã€‚ç‚¹å‡»ç¡®å®šå¼€å§‹ã€‚")) return;
      
      // ç»„å·è§„åˆ™
      const rules = {
        "äººå·¥æ™ºèƒ½æ¦‚è§ˆ": 4, "æœºå™¨å­¦ä¹ æ¦‚è§ˆ": 8, "æ·±åº¦å­¦ä¹ å’Œå¤§æ¨¡å‹": 10,
        "äººå·¥æ™ºèƒ½å¼€å‘æ¡†æ¶": 8, "åä¸ºäººå·¥æ™ºèƒ½å¹³å°": 8, "åº”ç”¨åœºæ™¯": 2
      };
      
      let examSet = [];
      const usedIds = new Set();

      for (const [cat, count] of Object.entries(rules)) {
        const catQs = questionBank.filter(q => q.category === cat);
        const shuffled = catQs.sort(() => 0.5 - Math.random());
        shuffled.slice(0, count).forEach(q => {
          examSet.push(q);
          usedIds.add(q.id);
        });
      }

      // è¡¥é½
      const remainingNeeded = 40 - examSet.length;
      if (remainingNeeded > 0) {
        const others = questionBank.filter(q => !usedIds.has(q.id));
        const shuffledOthers = others.sort(() => 0.5 - Math.random()).slice(0, remainingNeeded);
        examSet = examSet.concat(shuffledOthers);
      }

      appState.examQuestions = examSet.sort(() => 0.5 - Math.random());
      appState.examAnswers = {};
      appState.currentQIndex = 0;
      appState.mode = 'exam';

      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('home-view').classList.add('hidden');
      document.getElementById('practice-view').classList.add('hidden');
      document.getElementById('exam-view').classList.remove('hidden');

      renderExamPalette();
      loadExamQuestion();
      startTimer();
    }

    function startTimer() {
      let seconds = 60 * 60;
      const timerEl = document.getElementById('exam-timer');
      if (appState.examTimer) clearInterval(appState.examTimer);

      appState.examTimer = setInterval(() => {
        seconds--;
        const m = Math.floor(seconds / 60).toString().padStart(2, '0');
        const s = (seconds % 60).toString().padStart(2, '0');
        timerEl.innerText = `${m}:${s}`;
        if (seconds <= 0) {
          clearInterval(appState.examTimer);
          submitExam();
        }
      }, 1000);
    }

    function renderExamPalette() {
      const p = document.getElementById('exam-palette');
      p.innerHTML = '';
      appState.examQuestions.forEach((q, idx) => {
        const item = document.createElement('div');
        item.className = 'palette-item';
        item.innerText = idx + 1;
        item.onclick = () => {
          appState.currentQIndex = idx;
          loadExamQuestion();
        };
        item.id = `pal-${idx}`;
        p.appendChild(item);
      });
    }

    function loadExamQuestion() {
      const q = appState.examQuestions[appState.currentQIndex];
      document.getElementById('exam-q-type').innerText = q.type;
      document.getElementById('exam-q-cat').innerText = q.category || 'ç»¼åˆ';
      document.getElementById('exam-q-content').innerText = `${appState.currentQIndex + 1}. ${q.q}`;
      
      document.querySelectorAll('.palette-item').forEach(el => el.classList.remove('current'));
      document.getElementById(`pal-${appState.currentQIndex}`).classList.add('current');

      const container = document.getElementById('exam-options-area');
      container.innerHTML = '';
      const savedAns = appState.examAnswers[q.id] || [];
      
      q.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        const letter = String.fromCharCode(65 + idx);
        btn.innerHTML = `<span style="font-weight:bold;">${letter}.</span> ${opt}`;
        if (savedAns.includes(letter)) btn.classList.add('selected');
        btn.onclick = () => handleExamSelect(q, letter, btn);
        container.appendChild(btn);
      });
    }

    function handleExamSelect(q, letter, btn) {
      const isMulti = q.type === 'å¤šé€‰é¢˜';
      let currentAns = appState.examAnswers[q.id] || [];

      if (isMulti) {
        if (currentAns.includes(letter)) {
          currentAns = currentAns.filter(l => l !== letter);
          btn.classList.remove('selected');
        } else {
          currentAns.push(letter);
          btn.classList.add('selected');
        }
      } else {
        currentAns = [letter];
        const siblings = btn.parentNode.children;
        for (let sib of siblings) sib.classList.remove('selected');
        btn.classList.add('selected');
      }

      appState.examAnswers[q.id] = currentAns;
      const palItem = document.getElementById(`pal-${appState.currentQIndex}`);
      if (currentAns.length > 0) palItem.classList.add('answered');
      else palItem.classList.remove('answered');
    }

    function nextExamQ() {
      if (appState.currentQIndex < appState.examQuestions.length - 1) {
        appState.currentQIndex++;
        loadExamQuestion();
      }
    }

    function prevExamQ() {
      if (appState.currentQIndex > 0) {
        appState.currentQIndex--;
        loadExamQuestion();
      }
    }

    function markForReview() {
      document.getElementById(`pal-${appState.currentQIndex}`).classList.toggle('review');
    }

    function submitExam() {
      if (appState.mode !== 'exam') return;
      clearInterval(appState.examTimer);
      let score = 0;
      const wrongList = [];
      const pointPerQ = 1000 / 40;

      appState.examQuestions.forEach((q, idx) => {
        const userAns = (appState.examAnswers[q.id] || []).sort().join('');
        let correctArr = Array.isArray(q.ans) ? q.ans : q.ans.split('');
        if (typeof q.ans === 'string' && q.ans.length > 1 && q.type === 'å¤šé€‰é¢˜') correctArr = q.ans.split('');
        const correctStr = correctArr.sort().join('');

        if (userAns === correctStr) {
          score += pointPerQ;
        } else {
          wrongList.push({ idx: idx + 1, q: q, user: userAns, correct: correctStr });
          if (!appState.userProgress.mistakes.includes(q.id)) {
            appState.userProgress.mistakes.push(q.id);
          }
        }
      });
      saveProgress();

      const modal = document.getElementById('result-modal');
      document.getElementById('final-score').innerText = Math.round(score);
      const status = document.getElementById('pass-status');
      if (score >= 600) {
        status.innerText = "ğŸ‰ æ­å–œé€šè¿‡ï¼";
        status.style.color = "var(--success)";
      } else {
        status.innerText = "ğŸ˜” æœªé€šè¿‡ï¼Œç»§ç»­åŠªåŠ›";
        status.style.color = "var(--error)";
      }

      const ul = document.getElementById('wrong-list');
      ul.innerHTML = '';
      if (wrongList.length === 0) {
        ul.innerHTML = '<li>å¤ªæ£’äº†ï¼å…¨å¯¹ï¼</li>';
      } else {
        wrongList.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `ç¬¬${item.idx}é¢˜ (${item.q.type}) - ä½ çš„ç­”æ¡ˆ: ${item.user || 'æœªåš'} / æ­£ç¡®: ${item.correct} <button style='font-size:0.8rem; margin-left:5px' onclick='viewWrongDetail(${item.q.id})'>æŸ¥çœ‹</button>`;
          ul.appendChild(li);
        });
      }
      modal.style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('result-modal').style.display = 'none';
      switchMode('home');
    }

    function viewWrongDetail(id) {
      document.getElementById('result-modal').style.display = 'none';
      if (!appState.userProgress.mistakes.includes(id)) appState.userProgress.mistakes.push(id);
      appState.mode = 'mistakes';
      switchMode('mistakes');
      const index = appState.userProgress.mistakes.indexOf(id);
      appState.currentQIndex = index;
      loadQuestion();
    }

    // --- é€šç”¨æ•°æ®ç®¡ç† ---

    function toggleFavorite() {
      const q = appState.mode === 'mistakes'
        ? questionBank.find(i => i.id === appState.userProgress.mistakes[appState.currentQIndex])
        : questionBank[appState.currentQIndex];

      const idx = appState.userProgress.favorites.indexOf(q.id);
      if (idx === -1) {
        appState.userProgress.favorites.push(q.id);
        document.getElementById('fav-btn').classList.add('active');
      } else {
        appState.userProgress.favorites.splice(idx, 1);
        document.getElementById('fav-btn').classList.remove('active');
      }
      saveProgress();
    }

    function saveProgress() {
      localStorage.setItem('ai_ia_progress', JSON.stringify(appState.userProgress));
      updateStats();
    }

    function updateStats() {
      document.getElementById('total-questions-count').innerText = questionBank.length;
      document.getElementById('user-done-count').innerText = appState.userProgress.done.length;
      const rate = appState.userProgress.totalAttempted === 0 ? 0 :
        Math.round((appState.userProgress.correctCount / appState.userProgress.totalAttempted) * 100);
      document.getElementById('user-correct-rate').innerText = `${rate}%`;
      document.getElementById('user-mistake-count').innerText = appState.userProgress.mistakes.length;
    }

    function clearProgress() {
      if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰åˆ·é¢˜è®°å½•å—ï¼Ÿ(ä¸ä¼šåˆ é™¤å¯¼å…¥çš„é¢˜åº“)")) {
        appState.userProgress = { done: [], mistakes: [], favorites: [], correctCount: 0, totalAttempted: 0, lastSequenceIndex: 0 };
        saveProgress();
        location.reload();
      }
    }

    // æ–°å¢ï¼šæ¢å¤é»˜è®¤é¢˜åº“
    function restoreDefaultBank() {
        if(confirm("ç¡®å®šè¦æ¸…é™¤è‡ªå®šä¹‰å¯¼å…¥çš„é¢˜åº“ï¼Œæ¢å¤ä¸ºç³»ç»Ÿé»˜è®¤å—ï¼Ÿ\n(è¿™ä¸ä¼šæ¸…é™¤æ‚¨çš„åšé¢˜è¿›åº¦)")) {
            localStorage.removeItem('ai_ia_custom_bank');
            // é‡ç½®ç´¢å¼•é˜²æ­¢è¶Šç•Œ
            appState.userProgress.lastSequenceIndex = 0;
            saveProgress();
            location.reload();
        }
    }

    function exportData() {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appState.userProgress));
      const anchorNode = document.createElement('a');
      anchorNode.setAttribute("href", dataStr);
      anchorNode.setAttribute("download", "ai_learning_progress.json");
      document.body.appendChild(anchorNode);
      anchorNode.click();
      anchorNode.remove();
    }

    function importData() {
      document.getElementById('importFile').click();
    }

    function handleImport(input) {
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const data = JSON.parse(e.target.result);
          // 1. è¯†åˆ«é¢˜åº“ (Array)
          if (Array.isArray(data) && data.length > 0 && data[0].q && data[0].options) {
            if (confirm(`è¯†åˆ«åˆ°æ–°é¢˜åº“ (${data.length}é¢˜)ï¼\næ˜¯å¦å¯¼å…¥å¹¶æ›¿æ¢å½“å‰é¢˜åº“ï¼Ÿ\n(ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜æ­¤é¢˜åº“)`)) {
              questionBank = data;
              // --- æ ¸å¿ƒä¿®æ”¹ï¼šä¿å­˜è‡ªå®šä¹‰é¢˜åº“åˆ°LocalStorage ---
              try {
                localStorage.setItem('ai_ia_custom_bank', JSON.stringify(data));
              } catch (err) {
                alert("é¢˜åº“æ–‡ä»¶è¿‡å¤§ï¼Œæ— æ³•ç¼“å­˜åˆ°æœ¬åœ°ï¼Œä½†æœ¬æ¬¡ä½¿ç”¨æœ‰æ•ˆã€‚");
              }
              
              autoTagQuestions();
              appState.currentQIndex = 0;
              appState.userProgress.lastSequenceIndex = 0; // æ¢é¢˜åº“åé‡ç½®è¿›åº¦
              saveProgress();
              updateStats();
              alert("âœ… é¢˜åº“å¯¼å…¥æˆåŠŸï¼");
              if (appState.mode !== 'home') loadQuestion();
            }
          }
          // 2. è¯†åˆ«è¿›åº¦ (Object)
          else if (data.done && data.mistakes) {
            appState.userProgress = data;
            saveProgress();
            updateStats();
            alert("âœ… å­¦ä¹ è¿›åº¦å¯¼å…¥æˆåŠŸï¼");
          } else {
            alert("âŒ æ— æ³•è¯†åˆ«çš„æ–‡ä»¶æ ¼å¼");
          }
        } catch (err) {
          console.error(err);
          alert("æ–‡ä»¶è§£æå¤±è´¥");
        }
        input.value = '';
      };
      reader.readAsText(file);
    }

    // å¯åŠ¨
    init();

  </script>
</body>
</html>